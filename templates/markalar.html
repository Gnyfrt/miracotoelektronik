<!doctype html>
<html lang="tr">
{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2>Markalar & Anahtar Tipleri</h2>
    <form method="post" class="row g-3 mb-4">
        <div class="col-md-5">
            <input type="text" name="marka" class="form-control" placeholder="Yeni marka adı" required>
        </div>
        <div class="col-md-5">
            <input type="text" name="logo_url" class="form-control" placeholder="Logo URL (isteğe bağlı)">
        </div>
        <div class="col-md-2 d-grid">
            <button type="submit" class="btn btn-success">Ekle</button>
        </div>
    </form>
    <div class="accordion" id="markaAccordion">
        {% for marka in markalar %}
        <div class="accordion-item mb-2">
            <h2 class="accordion-header" id="heading{{ marka.id }}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ marka.id }}" aria-expanded="false" aria-controls="collapse{{ marka.id }}">
                    {% if marka.logo_url %}
                    <img src="{{ marka.logo_url }}" alt="{{ marka.ad }} logo" style="height:32px; width:auto; margin-right:10px;">
                    {% endif %}
                    {{ marka.ad }}
                </button>
            </h2>
            <div id="collapse{{ marka.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ marka.id }}" data-bs-parent="#markaAccordion">
                <div class="accordion-body">
                    <form method="post" action="{{ url_for('anahtar_ekle', marka_id=marka.id) }}" class="row g-2 mb-2">
                        <div class="col-8">
                            <input type="text" name="tip" class="form-control" placeholder="Anahtar tipi ekle" required>
                        </div>
                        <div class="col-4 d-grid">
                            <button type="submit" class="btn btn-primary">Anahtar Ekle</button>
                        </div>
                    </form>
                    <ul class="list-group">
                        {% for anahtar in marka.anahtarlar %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ anahtar.tip }}
                            <div>
                              <a href="{{ url_for('fiyat_gecmisi', anahtar_id=anahtar.id) }}" class="btn btn-sm btn-info me-2">Geçmiş</a>
                              <form method="post" action="{{ url_for('anahtar_sil', anahtar_id=anahtar.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-danger">Sil</button>
                              </form>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    <form method="post" action="{{ url_for('marka_sil', marka_id=marka.id) }}" class="mt-2">
                        <button type="submit" class="btn btn-outline-danger btn-sm">Markayı Sil</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    <a href="/" class="btn btn-link mt-4">Ana Sayfa</a>
</div>
{% endblock %}
</html>